---
layout: post
title: 实现一个自己的脚手架
subtitle: 记录一下实现一个简单命令行指令的方法
date: 2021-03-23
author:
header-img:
catalog: true
tags:
  - node.js
typora-root-url: ..
---

### 手写脚手架命令行工具

1.  创建`liou`命令

       <br>

    > 在 package.json 内添加“bin”
    > bin 下的文件没有格式，且第一行必须是`#! /usr/bin/env node`

    package.json：

    ```javascript
    /**
     *package.json文件
     */

    {
      "name": "cli",
      "version": "1.0.0",
      "description": "",
      "main": "index.js",

      "bin": {"liou": "index.js"}, //这里需要配置

      "scripts": {
        "test": "echo \"Error: no test  specified\" && exit 1"
      },
      "author": "liou",
      "license": "ISC"
    }
    ```

    index.js：

    ```javascript
    /**
     *index.js文件
     */
    #! /usr/bin/env node //必须添加
    console.log("hello");
    ```

    终端：

    ```php

    npm link // 取消链接 npm unlink
             //有时候可能需要在上面命令后面拼接 --force
    ```

    此时在命令行中输入 `liou`,则会执行`node index` 命令，打印出`hello`
    <br>

2.  使用 command 定义脚本

    ```javascript

      #! /usr/bin/env node

      const program = require("commander");

      //定义显示模块的版本号
      program.version(require("./package.json").  version);

      //解析终端指令
     program.parse(process.argv)
    ```

    这时命令行会有查看版本和帮助指令（-V -h）

    ![](https://ftp.bmp.ovh/imgs/2021/04/7368b0152e330141.jpg)
    ![](https://ftp.bmp.ovh/imgs/2021/03/c3614e56115284ba.jpg)

    在此基础上：

    ```javascript
    //添加其他选项,修改help选项
    program.option(
      "-d --dest <dest>",
      "a   destination folder; e.g: -d src/component"
    );
    program.option("-f --framework <framework>", "your framework; e.g: -f vue");
    program.on("--help", () => {
      console.log("");
      console.log("others:");
    });

    //解析终端指令
    program.parse(process.argv);

    //通过program._optionValues拿到后跟的参数
    console.log(program._optionValues);
    ```

    ![](https://ftp.bmp.ovh/imgs/2021/04/c9fc9475b48e5599.jpg)
    ![](https://ftp.bmp.ovh/imgs/2021/04/cf54312864c53b8f.jpg)

    最后创建项目命令:

    ```javascript

        #! /usr/bin/env node
        const program = require("commander");

        //定义显示模块的版本号
        program.version(require("./package.json")   . version);

        //添加其他选项,修改 help 选项
        program.option("-d --dest <dest>", "a   destination folder ; e.g: -d src/ component")
        program.option("-f --framework  <framework>", "your framework; e.g: -f   vue")
        program.on("--help", () => {
        console.log("");
        console.log("others:");
        })

        //创建项目命令
        program
        .command("create <projectName>  [otherArgs...] ")
        .description("clone a project from  github")
        .action((projectName, otherArgs) => {

                //1. 从 github 上 clone 项目到本地

                //2. 执行npm install

                //3. 执行npm run serve

                //4. 自动打开浏览器
            })

        //解析终端指令
        program.parse(process.argv);

    ```

    ![](https://ftp.bmp.ovh/imgs/2021/04/354e0af9bdff6de2.jpg)

    这时只需要在 action 中完善相应功能即可
